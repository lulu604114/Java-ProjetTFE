<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:shiro="http://shiro.apache.org/tags"
                template="../../WEB-INF/template/template.xhtml">

        <style type="text/css">
            .ui-datatable .ui-datatable-header {
                text-align: right !important;
            }

            .ui-selectcheckboxmenu-panel .ui-selectcheckboxmenu-header .ui-chkbox {
                display: none;
            }
        </style>

        <ui:define name="title">Listing patient</ui:define>
        <ui:define name="viewname">
            <li>Pages</li>
            <li>/</li>
        </ui:define>
        <ui:define name="content">
            <div class="ui-g">
                <div class="ui-g-12">
                    <div class="card">
                        <h1>Listing des patients</h1>
                        <h:form id="form">
                            <p:messages id="messages" />

                            <p:dataTable id="tablePatient" var="patient" value="#{patientBean.patients}" widgetVar="patientTable" multiViewState="true"
                                         rows="10" paginator="true"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,15"
                                         emptyMessage="Aucun patient trouvé" filteredValue="#{patientBean.filteredPatients}"
                            >
<!--                                         selectionMode="single" selection="#{patientBean.selectedPatient}" rowKey="#{patient.id}"-->

                                <p:growl id="msgs" showDetail="true" skipDetailIfEqualsSummary="true" />
                                <f:facet name="header">
                                    <p:outputPanel>
                                        <h:outputText value="Search all fields:" />
                                        <p:inputText id="globalFilter" onkeyup="PF('patientTable').filter()" style="width:150px" placeholder="Enter keyword"/>
                                    </p:outputPanel>
                                </f:facet>

<!--                                <p:ajax event="rowSelect" update=":form:patientDetail" oncomplete="PF('patientDialog').show()" />-->

                                <p:column headerText="Id" filterBy="#{patient.id}" sortBy="#{patient.id}" filterMatchMode="contains">
                                    <h:outputText value="#{patient.id}" />
                                </p:column>

                                <p:column headerText="Prénom" filterBy="#{patient.firstName}" sortBy="#{patient.firstName}" filterMatchMode="startsWith">
                                    <h:outputText value="#{patient.firstName}" />
                                </p:column>

                                <p:column headerText="Nom" filterBy="#{patient.lastName}" sortBy="#{patient.lastName}" filterMatchMode="startsWith">
                                    <h:outputText value="#{patient.lastName}" />
                                </p:column>

                                <p:column headerText="Action" >
                                    <p:commandButton update=":form:patientDetail" oncomplete="PF('patientDialog').show()" icon="fas fa-eye" title="Détails">
                                        <f:setPropertyActionListener value="#{patient}"  target="#{patientBean.selectedPatient}"  />
                                    </p:commandButton>
                                    <p:commandButton type="submit" action="#{patientBean.openRedirection()}" icon="fas fa-book-open">
                                        <f:setPropertyActionListener target="#{patientBean.patient}" value="#{patient}"    />
                                    </p:commandButton>
                                    <p:commandButton ajax="true" update=":form:tablePatient" action="#{patientBean.deletePatient(patient)}" icon="fas fa-trash-alt" title="Supprimer"/>
                                </p:column>

                                <f:facet name="paginatorTopLeft">
                                    <p:commandButton update=":modal-creation" oncomplete="PF('patientCreation').show()"  value="Ajouter un patient">
                                        <f:setPropertyActionListener value="#{patient}"  target="#{patientBean.selectedPatient}"  />
                                    </p:commandButton>
                                </f:facet>

                                <f:facet name="paginatorTopRight">
                                    <p:commandButton value="Réinitialiser les filtres" action="#{patientBean.clearTableState}" update="@form" />
                                </f:facet>

                            </p:dataTable>

<!--                            Modal-->
                            <p:dialog header="Patient Info" widgetVar="patientDialog" modal="true" responsive="true" draggable="false" closable="true">
                                <p:outputPanel id="patientDetail" style="text-align:center;">
                                    <p:panelGrid  columns="2" rendered="#{not empty patientBean.selectedPatient}" >
                                        <f:facet name="header">

                                        </f:facet>

                                        <h:outputText value="Numéro du patient :" />
                                        <h:outputText value="#{patientBean.selectedPatient.id}" />

                                        <h:outputText value="Prénom :" />
                                        <h:outputText value="#{patientBean.selectedPatient.firstName}" />

                                        <h:outputText value="Nom :" />
                                        <h:outputText value="#{patientBean.selectedPatient.lastName}" />

                                        <h:outputText value="Téléphone :" />
                                        <h:outputText value="#{patientBean.selectedPatient.phone}" />

                                        <h:outputText value="Email:" />
                                        <h:outputText value="#{patientBean.selectedPatient.email}" />

                                        <h:outputText value="Date de naissance:" />
                                        <h:outputText value="#{patientBean.selectedPatient.birthdate}" >
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>

                                    </p:panelGrid>
                                </p:outputPanel>
                            </p:dialog>
                        </h:form>
<!--                        Alerte de création-->
                        <p:growl id="growl" sticky="true" showDetail="true" life="3000" />
<!--                        Modal de création patient-->
                        <p:dialog id="modal-creation" header="Création patient" widgetVar="patientCreation" width="500"   responsive="true" draggable="false" closable="true" >

                                <h:form id="creation-modal-form">
                                    <div class="ui-g">
                                        <div class="ui-g-12" style="border: 1px solid #dedede; border-radius: 10px">
                                            <h4>Informations personnelles</h4>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <i class="fa fa-fw fa-user"></i>
                                            <p:outputLabel  value=" Prénom :" />
                                            <p:inputText value="#{patientBean.patient.firstName}" disabled="false" required="true" requiredMessage="Entrez un prénom"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" Nom :"/>
                                            <p:inputText value="#{patientBean.patient.lastName}" disabled="false" required="true" requiredMessage="Entrez un nom"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-12">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" Date d'anniversaire :"/>
                                            <p:inputText type="date" value="#{patientBean.patient.birthdate}" disabled="false" required="true" requiredMessage="Entrez la date d'anniversaire">
                                                <f:convertDateTime pattern="yyyy-mm-dd" />
                                            </p:inputText>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-4">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" Adresse :"/>
                                            <p:inputText value="#{patientBean.patient.adress}" disabled="false"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-4">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" N° :"/>
                                            <p:inputText value="#{patientBean.patient.streetNumber}" disabled="false"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-4">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" Bte :"/>
                                            <p:inputText value="#{patientBean.patient.streetBox}" disabled="false"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" Code Postal :"/>
                                            <p:inputText value="#{patientBean.patient.postalCode}" disabled="false"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" Ville :"/>
                                            <p:inputText value="#{patientBean.patient.city}" disabled="false"/>
                                        </div>
                                        <div class="ui-g-12" style="border: 1px solid #dedede; border-radius: 10px">
                                            <h4>Contact</h4>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <i class="fa fa-fw fa-user"></i>
                                            <p:outputLabel value=" Téléphone :" />
                                            <p:inputText value="#{patientBean.patient.phone}" disabled="false"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" Email :"/>
                                            <p:inputText value="#{patientBean.patient.email}" disabled="false"/>
                                        </div>
                                        <div class="ui-g-12" style="border: 1px solid #dedede; border-radius: 10px">
                                            <h4>Informations médicales</h4>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <i class="fa fa-fw fa-user"></i>
                                            <p:outputLabel value=" Niss :" />
                                            <p:inputText value="#{patientBean.patient.niss}" disabled="false"/>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <i class="fa fa-fw fa-envelope"></i>
                                            <p:outputLabel value=" Tiers payant :"/>
                                            <p:inputText value="#{patientBean.patient.tiersPayant}" disabled="false"/>
                                        </div>
                                    </div>
                                </h:form>

                                <br/>
                                <br/>
                                <f:facet name="footer">
                                    <p:commandButton id="creation-modal-close-btn" form="creation-modal-form" type="button" value="Fermer"
                                                     styleClass="secondary-button" onclick="PF('patientCreation').hide()"
                                                     actionListener="#{patientBean.cancel}" update=":content:msgs" ajax="true"/>
                                    <p:commandButton form="creation-modal-form" value="Enregistrer" update=":form:tablePatient"   styleClass="success-btn"
                                                     icon="fa fa-check" actionListener="#{patientBean.createPatient()}"
                                                     oncomplete="handleLoginRequest(xhr, status, args)"   ajax="true"/>
                                </f:facet>

                        </p:dialog>

                    </div>
                </div>
            </div>

        </ui:define>

</ui:composition>